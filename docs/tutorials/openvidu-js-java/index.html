---
layout: docs-layout
title: OpenVidu Documentation - openvidu-js-java
active: documentation
---

<script src="/js/plugins/jquery.min.js"></script>

<link rel="stylesheet" href="/css/syntax.css" />
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
	$(document).ready(function () {
		$('li.subnav_drop').find('ul.subnav').hide();
		$(".subnav").find("li:contains('openvidu-js-java')").each(function (i, e) {
			var currentElement = $(e);
			currentElement.parent().css({
				"display": "block",
				"visibility": "visible"
			}); //css("background-color","blue");
			currentElement.css({
				"display": "block",
				"visibility": "visible"
			});
		});
		$('li.subnav_drop div').click(function (i, e) {
			//$('li.subnav_drop span').not(this).find('ul.subnav').hide();
			$(this).parent().find('ul.subnav').toggle();
		});

		var minHeight = $('#sticky-menu').outerHeight() + 100;
		$('#doc-container').css('min-height', minHeight + 'px');
	});

	$(".wy-nav-content").find("li:contains('openvidu-js-java')").css('color', 'red');
</script>

<div id="doc-container" class="container text-justify">
		<div id="sticky-menu" class="col-lg-3 col-md-4 col-sm-12 col-xs-12">

			
			<nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
				<div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
					<div id="site-menu-title">
						<h3>Explore docs</h3>
						<hr>
					</div>
					<ul id="menu-list" class="current">
						 
						<li>
							<ul>

<li class="toctree-l1 ">
        <a class="" href="../../home/">What is OpenVidu?</a> 
</li>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Tutorials</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../">Intro</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-webcomponent/">openvidu-webcomponent</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-hello-world/">openvidu-hello-world</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-insecure-js/">openvidu-insecure-js</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-insecure-angular/">openvidu-insecure-angular</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-library-angular/">openvidu-library-angular</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-insecure-react/">openvidu-insecure-react</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-library-react/">openvidu-library-react</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-ionic/">openvidu-ionic</a> 
</li>

  

<li class="toctree-l1 current">
        <a class="current" href="./">openvidu-js-java</a>  
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-mvc-java/">openvidu-mvc-java</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-js-node/">openvidu-js-node</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../openvidu-mvc-node/">openvidu-mvc-node</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Demos</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../demos/openvidu-getaroom/">openvidu-getaroom</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../demos/openvidu-call/">openvidu-call</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../demos/openvidu-call-react/">openvidu-call-react</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../demos/openvidu-call-ionic/">openvidu-call-ionic</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../demos/openvidu-classroom/">openvidu-classroom</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Cheatsheet</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/join-session/">Join a session</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/leave-session/">Leave a session</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/subscribe-unsubscribe/">Subscribe/Unsubscribe from a stream</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/publish-unpublish/">Publish/Unpublish a stream</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/mute-audio-video/">Mute/Unmute audio and video</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/manage-videos/">Manage video players</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/share-data/">Share data between users</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../cheatsheet/send-messages/">Send text messages</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Advanced features</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../advanced-features/recording/">Recording</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../advanced-features/screen-share/">Screen share</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../advanced-features/speech-detection/">Speech detection</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../advanced-features/filters/">Voice and video filters</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Reference Documentation</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/openvidu-browser/">openvidu-browser API</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/openvidu-java-client/">openvidu-java-client API</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/openvidu-node-client/">openvidu-node-client API</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/REST-API/">REST  API</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/openvidu-server-params/">OpenVidu Server configuration</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../reference-docs/openvidu-server-cdr/">OpenVidu Server CDR</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Deployment</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../deployment/deploying-demos-aws/">Deploying OpenVidu Demos on AWS (TUTORIAL)</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../deployment/deploying-aws/">Deploying OpenVidu on AWS</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../deployment/deploying-ubuntu/">Deploying OpenVidu on Ubuntu</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../deployment/deploying-app/">Deploying your OpenVidu app</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../deployment/upgrading/">Upgrading OpenVidu</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li  class="subnav_drop">
        <div><span>Contribute</span></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../developing/">Developing OpenVidu</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul>

<li class="toctree-l1 ">
        <a class="" href="../../troubleshooting/">Troubleshooting / FAQ</a> 
</li>

</ul>
						</li>
						  
						<li>
							<ul>

<li class="toctree-l1 ">
        <a class="" href="../../releases/">Releases</a> 
</li>

</ul>
						</li>
						  
						<li>
							<ul>

<li  style="width: 100%; display: inline-block"  class="subnav_drop">
        <div><span>OpenVidu Pro</span><a style="all: unset; display: inline"
                        href="/docs/openvidu-pro/">
                        <div id="openvidu-pro-tag" style="float: right; background-color: rgb(0, 136, 170); color: white; font-weight: bold; padding: 0px 5px; border-radius: 3px; font-size: 13px; line-height:21px; font-family: Montserrat, sans-serif;">PRO</div>
                </a></div>
        <ul class="subnav" hidden>
                 

<li class="toctree-l1 ">
        <a class="" href="../../openvidu-pro/">Home</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../openvidu-pro/openvidu-inspector/">OpenVidu Inspector</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../openvidu-pro/detailed-session-monitoring/">Detailed session monitoring</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../openvidu-pro/deploying-openvidu-pro/">Deploying OpenVidu Pro</a> 
</li>

  

<li class="toctree-l1 ">
        <a class="" href="../../openvidu-pro/REST-API-pro/">REST API Pro</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						 
					</ul>
				</div>
				&nbsp;
			</nav>
		</div>

		<section class="col-lg-9 col-md-8 col-sm-12 col-xs-12">
			
			<div>
				<div>

					<div role="main">
						<div class="section">
							 <h1 id="openvidu-js-java">openvidu-js-java</h1>
<p><a href="https://github.com/OpenVidu/openvidu-tutorials/tree/master/openvidu-js-java" target="_blank"><i class="icon ion-social-github"> Check it on GitHub</i></a></p>
<p>A secure OpenVidu sample app with a Java backend and a SPA frontend. It makes use of <em>openvidu-java-client</em> to connect to OpenVidu Server. With regard to the use of OpenVidu, it is identical to <a href="../../tutorials/openvidu-mvc-java" target="_blank">openvidu-mvc-java</a>. This tutorial is intended for developers who feel more comfortable with a SPA (Single Page Application) architecture for their frontends.</p>
<h2 id="understanding-this-tutorial">Understanding this tutorial</h2>
<p align="center">
  <img class="img-responsive" src="https://docs.google.com/uc?id=0B61cQ4sbhmWScllLNlZTLVBTaUU">
</p>

<p>OpenVidu is composed by the modules displayed on the image above.</p>
<ul>
<li><strong>openvidu-browser</strong>: JavaScript library for the browser. It allows you to manage your video-calls straight away from your clients</li>
<li><strong>openvidu-java-client</strong>: server SDK for Java. Quick alternative to REST API</li>
<li><strong>openvidu-server</strong>: application to control Kurento Media Server</li>
<li><strong>Kurento Media Server</strong>: handles low level operations of media flow transmissions</li>
</ul>
<h2 id="running-this-tutorial">Running this tutorial</h2>
<p>1) Clone the repo:</p>
<pre><code class="bash">git clone https://github.com/OpenVidu/openvidu-tutorials.git
</code></pre>

<p>2) You will need <em>maven</em> to build the project. You can install it with:</p>
<pre><code class="bash">sudo apt-get install maven
</code></pre>

<p>3) Run the tutorial:</p>
<pre><code class="bash">cd openvidu-tutorials/openvidu-js-java
mvn package exec:java
</code></pre>

<p>4) <em>openvidu-server</em> and <em>Kurento Media Server</em> must be up and running in your development machine. The easiest way is running this Docker container which wraps both of them (you will need <a href="https://store.docker.com/search?type=edition&amp;offering=community" target="_blank">Docker CE</a>):</p>
<pre><code class="bash">docker run -p 4443:4443 --rm -e openvidu.secret=MY_SECRET openvidu/openvidu-server-kms:2.8.0
</code></pre>

<p>5) Go to <em><a href="https://localhost:5000" target="_blank"><code>https://localhost:5000</code></a></em> to test the app once the server is running. The first time you use the docker container, an alert message will suggest you accept the self-signed certificate of <em>openvidu-server</em> when you first try to join a video-call. To test two users in the same computer, use a standard window and an incognito window.</p>
<p><br></p>
<blockquote>
<p>If you are using <strong>Windows</strong>, read this <strong><a href="../../troubleshooting/#3-i-am-using-windows-to-run-the-tutorials-develop-my-app-anything-i-should-know" target="_blank">FAQ</a></strong> to properly run the tutorial</p>
<p>To learn <strong>some tips</strong> to develop with OpenVidu, check this <strong><a href="../../troubleshooting#2-any-tips-to-make-easier-the-development-of-my-app-with-openvidu" target="_blank">FAQ</a></strong></p>
</blockquote>
<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-login.png">
            <img class="img-responsive" src="/img/demos/secure-login.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-join.png">
            <img class="img-responsive" src="/img/demos/secure-join.png">
        </a>
    </div>
</div>

<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-session-2.png">
            <img class="img-responsive" src="/img/demos/secure-session-2.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-session-1.png">
            <img class="img-responsive" src="/img/demos/secure-session-1.png">
        </a>
    </div>
</div>

<h2 id="understanding-the-code">Understanding the code</h2>
<p>This is a very basic web application with a pretty simple JS/HTML/CSS frontend and a straightforward Java backend. OpenVidu assumes you can identify your users so you can tell which users can connect to which video-calls, and what role (and therefore what permissions) each one of them will have in the calls. You can do this as you prefer. Here our backend will manage the users and their sessions with the easy-to-use and non-intrusive <em>HttpSession</em> API. In these posts multiple options for user session management in Java are explained, inlcuding the one used in this tutorial: <a href="http://www.journaldev.com/1907/java-session-management-servlet-httpsession-url-rewriting" target="_blank">journaldev.com</a>, <a href="http://www.studytonight.com/servlet/session-management.php" target="_blank">studytonight.com</a>.</p>
<ul>
<li>
<p><strong>Backend</strong>: SpringBoot app with the following classes (<code>src/main/java</code> path, <code>io.openvidu.js.java</code> package)</p>
<ul>
<li><code>App.java</code> : entrypoint for the app</li>
<li><code>LoginController.java</code> : rest controller for handling login and logout operations</li>
<li><code>SessionController.java</code> : rest controller for getting OpenVidu tokens. It also stores our active video-calls and the users connected to them<br><br></li>
</ul>
</li>
<li>
<p><strong>Frontend</strong>: Plain JS/HTML/CSS files (<code>src/main/resources/static</code>)</p>
<ul>
<li><code>openvidu-browser-VERSION.js</code> : openvidu-browser library. You don't have to manipulate this file.</li>
<li><code>app.js</code> : sample application main JavaScritp file, which makes use of <em>openvidu-browser-VERSION.js</em>.</li>
<li>
<p><code>index.html</code> : HTML code for the form to login, the form to connect to a video-call and for the video-call itself. It has two links to both JavaScript files:</p>
<pre><code>&lt;script src="openvidu-browser-VERSION.js"&gt;&lt;/script&gt;
&lt;script src="app.js"&gt;&lt;/script&gt;
</code></pre>
</li>
<li>
<p><code>style.css</code>: some CSS classes to style <em>index.html</em>.</p>
</li>
</ul>
</li>
</ul>
<p>Let's describe the code following this scenario: a user logs into the app and connects to the video-call "TUTORIAL", where he publishes his webcam. A second user will connect to the same video-call just after that and publish its own webcam. Both of them will leave the call after a while.</p>
<hr />
<h3 id="1-user-logs-in">1) User logs in</h3>
<p>We have implemented a method for making HTTP POST requests to the backend, as we will need to make at least three of them: one for logging in, one for getting a token from openvidu-server and one for letting know our backend when any user leaves the video-call. The header of the method looks like this:</p>
<pre><code class="javascript">function httpPostRequest(url, body, errorMsg, callback)
</code></pre>

<p>Where <code>url</code> is the path of the POST operation, <code>body</code> the object to send as data, <code>errorMsg</code> the output error message if something goes wrong and <code>callback</code> the function to execute in case of success. As mentioned above, we need to call this method three times for each user that LOGS IN ðŸ¡’ CONNECTS TO A VIDEO-CALL ðŸ¡’ LEAVES THE VIDEO-CALL.</p>
<p><code>index.html</code> will first show a form to log in:</p>
<p align="center">
  <img class="img-responsive login-form-img" style="padding: 25px 0;" src="/img/docs/tutorials/login-form.png">
</p>

<p><code>app.js</code> sends a POST request to "/api-login/login" passing the username and the password retrieved from the HTML form whenever "Log in" button is clicked:</p>
<pre><code class="javascript">function logIn() {
    var user = $(&quot;#user&quot;).val(); // Username
    var pass = $(&quot;#pass&quot;).val(); // Password

    httpPostRequest(
        'api-login/login',
        {user: user, pass: pass},
        'Login WRONG',
        (response) =&gt; {
            // HTML shows logged-in page ...
        }
    );
}
</code></pre>

<p><code>LoginController.java</code> checks the params are correct and if so sets an <em>HttpSession</em> for the newly logged user (adding a "loggedUser" attribute with its username in the HttpSession object):</p>
<pre><code class="java">@RequestMapping(value = &quot;/login&quot;, method = RequestMethod.POST)
public ResponseEntity&lt;Object&gt; login(@RequestBody String userPass, HttpSession httpSession) 
    throws ParseException {

    System.out.println(&quot;Logging in | {user, pass}=&quot; + userPass);
    // Retrieve params from POST body
    JSONObject userPassJson = (JSONObject) new JSONParser().parse(userPass);
    String user = (String) userPassJson.get(&quot;user&quot;);
    String pass = (String) userPassJson.get(&quot;pass&quot;);

    if (login(user, pass)) { // Correct user-pass
        // Validate session and return OK 
        // Value stored in HttpSession allows us to identify the user in future requests
        httpSession.setAttribute(&quot;loggedUser&quot;, user);
        return new ResponseEntity&lt;&gt;(HttpStatus.OK);
    } else { // Wrong user-pass
        // Invalidate session and return error
        httpSession.invalidate();
        return new ResponseEntity&lt;&gt;(&quot;User/Pass incorrect&quot;, HttpStatus.UNAUTHORIZED);
    }
}
</code></pre>

<hr />
<h3 id="2-user-connects-to-tutorial-video-call">2) User connects to "TUTORIAL" video-call</h3>
<p>HTML will display now the user has logged a different form, asking for the video-call to connect and the nickname the user wants to have in it. So our 'publisher1' user would write TUTORIAL in "Session" field and press "Join!" button:</p>
<p align="center">
  <img class="img-responsive join-form-img" style="padding: 25px 0;" src="/img/docs/tutorials/join-form.png">
</p>

<p><code>app.js</code> will execute <code>joinSession()</code> method, which starts like this:</p>
<pre><code class="javascript">function joinSession() {
    getToken((token) =&gt; { ...
</code></pre>

<p>So the first thing to do here is to retrieve an OpenVidu <em>token</em> from our backend. Only when we have it available in the browser we will continue with the <em>join</em> operation. Let's see what <code>getToken()</code> looks like:</p>
<pre><code class="javascript">function getToken(callback) {
    sessionName = $(&quot;#sessionName&quot;).val(); // Video-call chosen by the user

    httpPostRequest(
        'api-sessions/get-token',
        {sessionName: sessionName},
        'Request of TOKEN gone WRONG:',
        (response) =&gt; {
            token = response[0]; // Get token from response
            console.warn('Request of TOKEN gone WELL (TOKEN:' + token + ')');
            callback(token); // Continue the join operation
        }
    );
}
</code></pre>

<p>Here is the second time we must call our <code>httpPostRequest()</code> method, sending the session we want to connect (<code>sessionName</code> parameter) and waiting to get a <em>token</em> as response. The interesting part here is in <code>SessionController.java</code> at <code>/api-sessions/get-token</code>. First of all there are some important attributes in this class we must mention:</p>
<pre><code class="java">// OpenVidu object as entrypoint of the SDK
private OpenVidu openVidu;

// Collection to pair session names and OpenVidu Session objects
private Map&lt;String, Session&gt; mapSessions = new ConcurrentHashMap&lt;&gt;();
// Collection to pair session names and tokens (the inner Map pairs tokens and role associated)
private Map&lt;String, Map&lt;String, OpenViduRole&gt;&gt; mapSessionNamesTokens = new ConcurrentHashMap&lt;&gt;();

// URL where our OpenVidu server is listening
private String OPENVIDU_URL;
// Secret shared with our OpenVidu server
private String SECRET;
</code></pre>

<p>Rest controller method begins retrieving the param send by the client, which in this case is the video-call name ("TUTORIAL"), as well as preparing a param we will need a little further on: <code>tokenOptions</code>.</p>
<pre><code class="java">@RequestMapping(value = &quot;/get-token&quot;, method = RequestMethod.POST)
    public ResponseEntity&lt;JSONObject&gt; getToken(@RequestBody String sessionNameParam,
        HttpSession httpSession) throws ParseException {

    // ... check the user is logged with HttpSession and continue ...

    JSONObject sessionJSON = (JSONObject) new JSONParser().parse(sessionNameParam);

    // The video-call to connect (&quot;TUTORIAL&quot;)
    String sessionName = (String) sessionJSON.get(&quot;sessionName&quot;);

    // Role associated to this user
    OpenViduRole role = LoginController.users.get(httpSession.getAttribute(&quot;loggedUser&quot;)).role;

    // Optional data to be passed to other users when this user connects to the video-call
    // In this case, a JSON with the value we stored in the HttpSession object on login
    String serverData = &quot;{\&quot;serverData\&quot;: \&quot;&quot; + httpSession.getAttribute(&quot;loggedUser&quot;) + &quot;\&quot;}&quot;;

    // Build tokenOptions object with the serverData and the role
    TokenOptions tokenOptions = new TokenOptions.Builder().data(serverData).role(role).build();

    JSONObject responseJson = new JSONObject();
</code></pre>

<p>Just after that we check if the session "TUTORIAL" already exists</p>
<pre><code class="java">if (this.mapSessions.get(sessionName) != null) { ...
</code></pre>

<p>In this case it doesn't because 'publisher1' is the first user connecting to it. So we directly create a new session:</p>
<pre><code class="java">// New session
System.out.println(&quot;New session &quot; + sessionName);
try {

    // Create a new OpenVidu Session
    Session session = this.openVidu.createSession();
    // Generate a new token with the recently created tokenOptions
    String token = session.generateToken(tokenOptions);

    // Store the session and the token in our collections
    this.mapSessions.put(sessionName, session);
    this.mapSessionNamesTokens.put(sessionName, new ConcurrentHashMap&lt;&gt;());
    this.mapSessionNamesTokens.get(sessionName).put(token, role);

    // Prepare the response with the token
    responseJson.put(0, token);

    // Return the response to the client
    return new ResponseEntity&lt;&gt;(responseJson, HttpStatus.OK);

} catch (Exception e) {
    // If error generate an error message and return it to client
    return getErrorResponse(e);
}
</code></pre>

<p>We are almost there! Now in <code>app.js</code> we can init a new Session and connect to it with <em>token</em>:</p>
<pre><code class="javascript">// --- 1) Get an OpenVidu object ---

OV = new OpenVidu();

// --- 2) Init a session ---

session = OV.initSession();

// --- 3) Specify the actions when events take place in the session ---

// On every new Stream received...
session.on('streamCreated', (event) =&gt; {

    // Subscribe to the Stream to receive it
    // HTML video will be appended to element with 'video-container' id
    var subscriber = session.subscribe(event.stream, 'video-container');

    // When the HTML video has been appended to DOM...
    subscriber.on('videoElementCreated', (event) =&gt; {

        // Add a new HTML element for the user's name and nickname over its video
        appendUserData(event.element, subscriber.stream.connection);
    });
});

// On every Stream destroyed...
session.on('streamDestroyed', (event) =&gt; {
    // Delete the HTML element with the user's name and nickname
    removeUserData(event.stream.connection);
});

// --- 4) Connect to the session passing the retrieved token and some more data from
//        the client (in this case a JSON with the nickname chosen by the user) ---

var nickName = $(&quot;#nickName&quot;).val();
session.connect(token, { clientData: nickName })
    .then(() =&gt; {

        // --- 5) Set page layout for active call ---

        var userName = $(&quot;#user&quot;).val();
        $('#session-title').text(sessionName);
        $('#join').hide();
        $('#session').show();


        // Here we check somehow if the user has 'PUBLISHER' role before
        // trying to publish its stream. Even if someone modified the client's code and
        // published the stream, it wouldn't work if the token sent in Session.connect
        // method is not recognized as 'PUBLIHSER' role by OpenVidu Server
        if (isPublisher(userName)) {

            // --- 6) Get your own camera stream ---

            var publisher = OV.initPublisher('video-container', {
                audioSource: undefined, // The source of audio. If undefined default microphone
                videoSource: undefined, // The source of video. If undefined default webcam
                publishAudio: true,     // Whether you want to start publishing with your audio unmuted or not
                publishVideo: true,     // Whether you want to start publishing with your video enabled or not
                resolution: '640x480',  // The resolution of your video
                frameRate: 30,          // The frame rate of your video
                insertMode: 'APPEND',   // How the video is inserted in the target element 'video-container'
                mirror: false           // Whether to mirror your local video or not
            });

            // --- 7) Specify the actions when events take place in our publisher ---

            // When our HTML video has been added to DOM...
            publisher.on('videoElementCreated', (event) =&gt; {
                // Init the main video with ours and append our data
                var userData = {
                    nickName: nickName,
                    userName: userName
                };
                initMainVideo(event.element, userData);
                appendUserData(event.element, userData);
                $(event.element).prop('muted', true); // Mute local video
            });


            // --- 8) Publish your stream ---

            session.publish(publisher);

        } else {
            console.warn('You don\'t have permissions to publish');
            initMainVideoThumbnail(); // Show SUBSCRIBER message in main video
        }
    })
    .catch(error =&gt; {
        console.warn('There was an error connecting to the session:', error.code, error.message);
    });
</code></pre>

<p>The user will now see its own video on the page. The connection to the session has completed!</p>
<hr />
<h3 id="3-another-user-connects-to-the-video-call">3) Another user connects to the video-call</h3>
<p>The process would be exactly the same as before until <code>SessionController.java</code> executes <code>getToken()</code> method. Now session 'TUTORIAL' already exists, so now we do enter the <em>if</em> branch that we ignored in the previous step:</p>
<pre><code class="java">if (this.mapSessions.get(sessionName) != null) {
    // Session already exists
    System.out.println(&quot;Existing session &quot; + sessionName);
    try {

        // Generate a new token with the recently created tokenOptions
        String token = this.mapSessions.get(sessionName).generateToken(tokenOptions);

        // Update our collection storing the new token
        this.mapSessionNamesTokens.get(sessionName).put(token, role);

        // Prepare the response with the token
        responseJson.put(0, token);

        // Return the response to the client
        return new ResponseEntity&lt;&gt;(responseJson, HttpStatus.OK);
    } catch (OpenViduJavaClientException e1) {
        // If internal error generate an error message and return it to client
        return getErrorResponse(e1);
    } catch (OpenViduHttpException e2) {
        if (404 == e2.getStatus()) {
            // Invalid sessionId (user left unexpectedly). Session object is not valid
            // anymore. Clean collections and continue as new session
            this.mapSessions.remove(sessionName);
            this.mapSessionNamesTokens.remove(sessionName);
        }
    }
}
</code></pre>

<p>The code executed in <code>app.js</code> would also be the same. After the <code>Session.publish()</code> method has been successful, both users will be seeing each other's video, as well as the username and nickname uppon it.</p>
<hr />
<h3 id="4-users-leave-the-video-call">4) Users leave the video-call</h3>
<p>After a while both users decide to leave the session. Apart from calling <code>leaveSession()</code> (and therefore <code>session.disconnect()</code>) to destroy the connection on OpenVidu Server, we need to run the last POST operation: we must let the backend know that certain user has left the session so it can update the collections with the active sessions and tokens. To sum up, <code>session.disconnect()</code> updates our OpenVidu Server and the POST operation updates our application's backend.
For the POST operation, in <code>app.js</code> we run:</p>
<pre><code class="javascript">function removeUser() {
    httpPostRequest(
        'api-sessions/remove-user',
        {sessionName: sessionName, token: token},
        'User couldn\'t be removed from session',
        (response) =&gt; {
            console.warn(&quot;You have been removed from session &quot; + sessionName);
        }
    );
}
</code></pre>

<p>And in <code>SessionController.java</code> we update the collections:</p>
<pre><code class="java">@RequestMapping(value = &quot;/remove-user&quot;, method = RequestMethod.POST)
public ResponseEntity&lt;JSONObject&gt; removeUser(@RequestBody String sessionNameToken,
    HttpSession httpSession) throws Exception {

    // ... check the user is logged with HttpSession and continue ...

    // Retrieve the params from BODY
    JSONObject sessionNameTokenJSON = (JSONObject) new JSONParser().parse(sessionNameToken);
    String sessionName = (String) sessionNameTokenJSON.get(&quot;sessionName&quot;);
    String token = (String) sessionNameTokenJSON.get(&quot;token&quot;);

    // If the session exists (&quot;TUTORIAL&quot; in this case)
    if (this.mapSessions.get(sessionName) != null &amp;&amp; this.mapSessionNamesTokens.get(sessionName) != null) {

        // If the token exists and is succesfully removed
        if (this.mapSessionNamesTokens.get(sessionName).remove(token) != null) {
            // User left the session
            if (this.mapSessionNamesTokens.get(sessionName).isEmpty()) {
                // Last user left: session must be removed
                this.mapSessions.remove(sessionName);
            }
            return new ResponseEntity&lt;&gt;(HttpStatus.OK);
        } else {
            // The TOKEN wasn't valid
            System.out.println(&quot;Problems in the app server: the TOKEN wasn't valid&quot;);
            return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);
        }
    } else {
        // The SESSION does not exist
        System.out.println(&quot;Problems in the app server: the SESSION does not exist&quot;);
        return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
</code></pre>

<p>When the last user leaves the session <code>this.mapSessions.remove(sessionName);</code> will be executed: this means the session is empty and that it has been closed in OpenVidu Server. All our Session objects and tokens associated to them will be invalidated.</p>
<hr />
<blockquote>
<p>At this point we have covered all the important code from the tutorial. With this scenario we have seen the most common use-case, but you can modify whatever you want to suit your needs. And remember that this is just one of the many possible approaches: <strong>you can implement your frontend and your backend as you want</strong>.</p>
<p>The only actual requirements are getting a valid <strong><em>token</em></strong> from  <strong><em>openvidu-server</em></strong> (by using <a href="../../reference-docs/openvidu-java-client/" target="_blank">openvidu-java-client</a>, <a href="../../reference-docs/openvidu-node-client/" target="_blank">openvidu-node-client</a> or the <a href="../../reference-docs/REST-API/" target="_blank">REST API</a>) and use it in <strong><em>openvidu-browser</em></strong> to connect your clients to the sessions with <code>Session.connect(token)</code></p>
</blockquote>
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>
<script>
  $().fancybox({
    selector : '[data-fancybox="gallery"]',
    infobar : true,
    arrows : false,
    loop: true,
    protect: true,
    transitionEffect: 'slide',
    buttons : [
        'close'
    ],
    clickOutside : 'close',
    clickSlide   : 'close',
  });
</script></p> 
						</div>
					</div> <footer>
<hr>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../openvidu-mvc-java/" class="btn btn-xs btn-primary float-right" title="openvidu-mvc-java">Next &raquo;<span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../openvidu-ionic/" class="btn btn-xs btn-primary" title="openvidu-ionic"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  <div id="edit-github">
  
	  <a href="https://github.com/OpenVidu/openvidu.io-docs/blob/master/docs/tutorials/openvidu-js-java.md"><i class="icon ion-social-github"></i> Edit Documentation on GitHub</a>
  
  </div>
</footer> 
				</div>
			</div>
		</section>
</div>