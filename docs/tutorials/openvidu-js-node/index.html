---
layout: docs-layout
title: OpenVidu Documentation - openvidu-js-node
active: documentation
---

<script src="/js/plugins/jquery.min.js"></script>

<link rel="stylesheet" href="/css/syntax.css" />
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
	$(document).ready(function () {
		$('li.subnav_drop').find('ul.subnav').hide();
		$(".subnav").find("li:contains('openvidu-js-node')").each(function (i, e) {
			var currentElement = $(e);
			currentElement.parent().css({
				"display": "block",
				"visibility": "visible"
			}); //css("background-color","blue");
			currentElement.css({
				"display": "block",
				"visibility": "visible"
			});
		});
		$('li.subnav_drop div').click(function (i, e) {
			//$('li.subnav_drop span').not(this).find('ul.subnav').hide();
			$(this).parent().find('ul.subnav').toggle();
		});

		var minHeight = $('#sticky-menu').outerHeight() + 100;
		$('#doc-container').css('min-height', minHeight + 'px');
	});

	$(".wy-nav-content").find("li:contains('openvidu-js-node')").css('color', 'red');
</script>

<div id="doc-container" class="container text-justify">
		<div id="sticky-menu" class="col-lg-3 col-md-4 col-sm-12 col-xs-12">

			
			<nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
				<div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
					<div id="site-menu-title">
						<h3>Explore docs</h3>
						<hr>
					</div>
					<ul id="menu-list" class="current">
						 
						<li>
							<ul> 

<li class="toctree-l1 ">
    <a class="" href="../../home/">What is OpenVidu?</a> 
</li>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Tutorials</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../">Intro</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-hello-world/">openvidu-hello-world</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-insecure-js/">openvidu-insecure-js</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-insecure-angular/">openvidu-insecure-angular</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-js-java/">openvidu-js-java</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-mvc-java/">openvidu-mvc-java</a> 
</li>

   

<li class="toctree-l1 current">
    <a class="current" href="./">openvidu-js-node</a>  
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-mvc-node/">openvidu-mvc-node</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-getaroom/">openvidu-getaroom</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>How do I ... ?</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/create-session/">Create a session</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/join-session/">Join a session</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/leave-session/">Leave a session</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/subscribe-unsubscribe/">Subscribe/Unsubscribe from a stream</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/publish-unpublish/">Publish/Unpublish a stream</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/mute-audio-video/">Mute/Unmute audio and video</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/share-data/">Share data between users</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../how-do-i/send-messages/">Send text messages</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Advanced features</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../advanced-features/recording/">Recording</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../advanced-features/screen-share/">Screen share</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../advanced-features/speech-detection/">Speech detection</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Reference Documentation</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-browser/">openvidu-browser API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-java-client/">openvidu-java-client API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-node-client/">openvidu-node-client API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/REST-API/">REST  API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-server-params/">OpenVidu Server configuration</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-artifacts/">OpenVidu Artifacts</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Deployment</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-demos-aws/">Deploying OpenVidu Demos on AWS (TUTORIAL)</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-aws/">Deploying OpenVidu Server and your app on AWS</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-ubuntu/">Deploying OpenVidu in Ubuntu</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/custom-certificate/">Using your own certificate</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Contribute</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../developing/">Developing OpenVidu</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="toctree-l1 ">
    <a class="" href="../../troubleshooting/">Troubleshooting / FAQ</a> 
</li>

</ul>
						</li>
						 
					</ul>
				</div>
				&nbsp;
			</nav>
		</div>

		<section class="col-lg-9 col-md-8 col-sm-12 col-xs-12">
			
			<div>
				<div>

					<div role="main">
						<div class="section">
							 <h1 id="openvidu-js-node">openvidu-js-node</h1>
<p><a href="https://github.com/OpenVidu/openvidu-tutorials/tree/master/openvidu-js-node" target="_blank"><i class="icon ion-social-github"> Check it on GitHub</i></a></p>
<p>A secure OpenVidu sample app with a Node backend and a SPA frontend. It makes use of the <em>openvidu-node-client</em> to get the necessary params from OpenVidu Server.</p>
<h2 id="understanding-this-tutorial">Understanding this tutorial</h2>
<p align="center">
  <img class="img-responsive" src="https://docs.google.com/uc?id=0B61cQ4sbhmWSVkNVZ2s3cmk2aHM">
</p>

<p>OpenVidu is composed by the modules displayed on the image above.</p>
<ul>
<li><strong>openvidu-browser</strong>: JavaScript library for the browser. It allows you to manage your video-calls straight away from your clients</li>
<li><strong>openvidu-node-client</strong>: NPM package to easily get the necessary params (sessionId's and tokens) from openvidu-server. Quick alternative to REST API</li>
<li><strong>openvidu-server</strong>: Java application that controls Kurento Media Server</li>
<li><strong>Kurento Media Server</strong>: server that handles low level operations of media flow transmissions</li>
</ul>
<blockquote>
<p>You will only have to make use of <strong>openvidu-browser</strong> and <strong>openvidu-node-client</strong> to get this sample app working</p>
</blockquote>
<h2 id="running-this-tutorial">Running this tutorial</h2>
<p>1) Clone the repo:</p>
<pre><code class="bash">git clone https://github.com/OpenVidu/openvidu-tutorials.git
</code></pre>

<p>2) You will need <em>node</em> to execute the app. You can install them with:</p>
<pre><code class="bash">sudo curl -sL https://deb.nodesource.com/setup_6.x | sudo bash -
sudo apt-get install -y nodejs
</code></pre>

<p>3) Run the tutorial with the following commands. They will install the NPM dependencies and will execute <code>server.js</code> server passing two arguments: "localhost:8443" as the URL where <em>openvidu-server</em> will be listening and "MY_SECRET" as the secret share with it:</p>
<pre><code class="bash">cd openvidu-tutorials/openvidu-js-node
npm install
node server.js localhost:8443 MY_SECRET
</code></pre>

<p>4) <em>openvidu-server</em> and <em>Kurento Media Server</em> must be up and running in your development machine. The easiest way is running this Docker container which wraps both of them (you will need <a href="https://store.docker.com/search?type=edition&amp;offering=community">Docker CE</a>):</p>
<pre><code class="bash">docker run -p 8443:8443 --rm -e KMS_STUN_IP=stun.l.google.com -e KMS_STUN_PORT=19302 -e openvidu.secret=MY_SECRET openvidu/openvidu-server-kms
</code></pre>

<p>5) Go to <a href="https://localhost:5000"><code>https://localhost:5000</code></a> to test the app once the server is running. The first time you use the docker container, an alert message will suggest you accept the self-signed certificate of <em>openvidu-server</em> when you first try to join a video-call. To test two users in the same computer, use a standard window and an incognito window.</p>
<p><br></p>
<blockquote>
<p>To learn <strong>some tips</strong> to develop with OpenVidu, check this <strong><a href="../../troubleshooting#2-any-tips-to-make-easier-the-development-of-my-app-with-openvidu">FAQ</a></strong></p>
<p>If you are using <strong>Windows</strong>, read this <strong><a href="../../troubleshooting/#3-i-am-using-windows-to-run-the-tutorials-develop-my-app-anything-i-should-know">FAQ</a></strong> to properly run the tutorial</p>
</blockquote>
<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-login.png">
            <img class="img-responsive" src="/img/demos/secure-login.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-join.png">
            <img class="img-responsive" src="/img/demos/secure-join.png">
        </a>
    </div>
</div>

<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-session-1.png">
            <img class="img-responsive" src="/img/demos/secure-session-1.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery" href="/img/demos/secure-session-2.png">
            <img class="img-responsive" src="/img/demos/secure-session-2.png">
        </a>
    </div>
</div>

<h2 id="understanding-the-code">Understanding the code</h2>
<p>This is a very basic web application with a pretty simple JS/HTML/CSS frontend and a straightforward Node backend with <a href="http://expressjs.com"><em>express</em></a>. OpenVidu assumes you can identify your users so you can tell which users can connect to which video-calls, and what role (and therefore what permissions) each one of them will have in the calls. You can do this as you prefer. Here our backend will manage the users and their sessions with the easy-to-use and non-intrusive <a href="https://github.com/expressjs/session"><em>express-session</em></a> API.</p>
<ul>
<li>
<p><strong>Backend</strong>: node server</p>
<ul>
<li><code>server.js</code> : single file which handles all operations of server.</li>
</ul>
</li>
<li>
<p><strong>Frontend</strong>: Pure JS/HTML/CSS files (<code>/public</code> folder)</p>
<ul>
<li><code>openvidu-browser-VERSION.js</code> : openvidu-browser library. You don't have to manipulate this file. </li>
<li><code>app.js</code> : sample application main JavaScritp file, which makes use of <em>openvidu-browser-VERSION.js</em>.</li>
<li>
<p><code>index.html</code> : HTML code for the form to login, the form to connect to a video-call and for the video-call itself. It has two links to both JavaScript files:</p>
<pre><code>&lt;script src="openvidu-browser-VERSION.js"&gt;&lt;/script&gt;
&lt;script src="app.js"&gt;&lt;/script&gt;
</code></pre>
</li>
<li>
<p><code>style.css</code>: some CSS classes to style <em>index.html</em>.</p>
</li>
</ul>
</li>
</ul>
<p>Let's describe the code following this scenario: a user logs in to the app and connects to the video-call "TUTORIAL", where he publishes his webcam. A second user will connect to the same video-call just after that and publish its own webcam. Both of them will leave the call after a while.</p>
<hr />
<h3 id="1-user-logs-in">1) User logs in</h3>
<p>We have implemented a method for making HTTP requests to the backend, as we will need to    make at least three of them: one for logging in, one for getting the sessionId and a valid token from openvidu-server and one for letting know our backend when any user leaves the video-call. The header of the method looks like this:</p>
<pre><code class="javascript">function httpRequest(method, url, body, errorMsg, callback)
</code></pre>

<p>Where <code>method</code> is whether "POST" or "GET", <code>url</code> the path of the REST operation, <code>body</code> the data to be passed, <code>errorMsg</code> the output error message if something goes wrong and <code>callback</code> the function to execute in case of success. As mentioned above, we need to call this method three times for each user that LOGS IN ðŸ¡’ CONNECTS TO A VIDEO-CALL ðŸ¡’ LEAVES THE VIDEO-CALL.</p>
<p><code>index.html</code> will first show a form to log in:</p>
<p align="center">
  <img class="img-responsive login-form-img" style="padding: 25px 0;" src="/img/docs/tutorials/login-form.png">
</p>

<p><code>app.js</code> sends an HTTP request to "/api-login/login" passing the username and the password retrieved from the HTML form whenever "Log in" button is clicked:</p>
<pre><code class="javascript">function logIn() {
    var user = $(&quot;#user&quot;).val(); // Username
    var pass = $(&quot;#pass&quot;).val(); // Password
    var jsonBody = JSON.stringify({ // Body of POST request
        'user': user,
        'pass': pass
    });

    httpRequest('POST', '/api-login/login', jsonBody, 'Login WRONG',
      function successCallback(response){ // Send POST request
        // HTML shows logged-in page ...
    });
}
</code></pre>

<p><code>server.js</code> at <code>/api-login/login</code> checks the params are correct and if so sets an active session for the newly logged user (adding a <em>loggedUser</em> property with its username in the <em>req.session</em> object):</p>
<pre><code class="javascript">app.post('/api-login/login', function (req, res) {

    // Retrieve params from POST body
    var user = req.body.user;
    var pass = req.body.pass;

    if (login(user, pass)) { // Correct user-pass
        // Validate session and return OK 
        // Value stored in req.session allows us to identify the user in future requests
        req.session.loggedUser = user;
        res.status(200).send();
    } else { // Wrong user-pass
        // Invalidate session and return error
        req.session.destroy();
        res.status(401).send('User/Pass incorrect');
    }
});
</code></pre>

<hr />
<h3 id="2-user-connects-to-tutorial-video-call">2) User connects to "TUTORIAL" video-call</h3>
<p>HTML will display now the user has logged a different form, asking for the video-call to connect and the nickname the user wants to have in it. So our 'publisher1' user would write TUTORIAL in "Session" field and press "Join!" button:</p>
<p align="center">
  <img class="img-responsive join-form-img" style="padding: 25px 0;" src="/img/docs/tutorials/join-form.png">
</p>

<p><code>app.js</code> will execute <code>joinSession()</code> method, which starts like this:</p>
<pre><code class="javascript">function joinSession() {
    getSessionIdAndToken(function () { ...
</code></pre>

<p>So the first thing to do here is to retrieve a <em>sessionId</em> and a <em>token</em> from our backend. Only when we have them available in the browser we will continue with the <em>join</em> operation. Let's see what <code>getSessionIdAndToken()</code> looks like:</p>
<pre><code class="javascript">function getSessionIdAndToken(callback) {
    sessionName = $(&quot;#sessionName&quot;).val(); // Video-call chosen by the user (&quot;TUTORIAL&quot;)
    nickName = $(&quot;#participantName&quot;).val(); // Nickname chosen by the user
    var jsonBody = JSON.stringify({ // Body of POST request
        'session': sessionName
    });

    // Send POST request
    httpRequest('POST', '/api-sessions/get-sessionid-token', jsonBody, 
     'Request of SESSIONID and TOKEN gone WRONG:', function successCallback(response){
        sessionId = response[0]; // Get sessionId from response
        token = response[1]; // Get token from response
        callback(); // Continue the join operation
    });
}
</code></pre>

<p>Here is the second time we must call our <code>httpRequest()</code> method, sending the session we want to connect ("TUTORIAL") and waiting to get a <em>sessionId</em> and a <em>token</em> as response. The interesting part here is in <code>server.js</code> controller at <code>/api-sessions/get-sessionid-token</code>. First of all there are some important attributes in this class we must mention:</p>
<pre><code class="javascript">// Environment variable: URL where our OpenVidu server is listening
var OPENVIDU_URL = process.argv[2];
// Environment variable: secret shared with our OpenVidu server
var OPENVIDU_SECRET = process.argv[3];

// OpenVidu object to ask openvidu-server for sessionId and token
var OV = new OpenVidu(OPENVIDU_URL, OPENVIDU_SECRET);

// Collection to pair session names and OpenVidu Session objects
var mapSessionNameSession = {};
// Collection to pair sessionId's (identifiers of Session objects) and tokens
var mapSessionIdTokens = {};
</code></pre>

<p>Rest controller method begins retrieving the param send by the client, which in this case is the video-call name ("TUTORIAL"), as well as preparing a param we will need a little further on: <code>tokenOptions</code>.</p>
<pre><code class="javascript">app.post('/api-sessions/get-sessionid-token', function (req, res) {
    // Check the user is logged ... 

    // The video-call to connect (&quot;TUTORIAL&quot;)
    var sessionName = req.body.session;

    // Role associated to this user
    var role = users.find(u =&gt; (u.user === req.session.loggedUser)).role;

    // Optional data to be passed to other users when this user connects to the video-call
    // In this case, a JSON with the value we stored in the req.session object on login
    var serverData = '{&quot;serverData&quot;: &quot;' + req.session.loggedUser + '&quot;}';

    // Build tokenOptions object with the serverData and the role
    var tokenOptions = new TokenOptions.Builder()
        .data(serverData)
        .role(role)
        .build();
</code></pre>

<p>Just after that an <em>if-else</em> statement comes into play: does the session "TUTORIAL" already exist? </p>
<pre><code class="javascript">if (mapSessionNameSession[sessionName]) { ...
</code></pre>

<p>In this case it doesn't because 'publisher1' is the first user connecting to it. So we focus on the <em>else</em> branch:</p>
<pre><code class="javascript">else { // New session: return a new sessionId and a new token

    // Create a new OpenVidu Session
    var mySession = OV.createSession();

    // Get the sessionId asynchronously
    mySession.getSessionId(function (sessionId) {

        // Store the new Session in the collection of Sessions
        mapSessionNameSession[sessionName] = mySession;
        // Store a new empty array in the collection of tokens
        mapSessionIdTokens[sessionId] = [];

        // Generate a new token asynchronously with the recently created tokenOptions
        mySession.generateToken(tokenOptions, function (token) {

            // Store the new token in the collection of tokens
            mapSessionIdTokens[sessionId].push(token);

            // Return the sessionId and token to the client
            res.status(200).send({
                0: sessionId,
                1: token
            });
        });
    });
}
</code></pre>

<p>We are almost there! Now in <code>app.js</code> we can init a new Session with <em>sessionId</em> and connect to it with <em>token</em>:</p>
<pre><code class="javascript">// --- 1) Get an OpenVidu object and init a session with the retrieved sessionId ---

OV = new OpenVidu();
session = OV.initSession(sessionId);


// --- 2) Specify the actions when events take place ---

// On every new Stream received...
session.on('streamCreated', function (event) {

    // Subscribe to the Stream to receive it
    // HTML video will be appended to element with 'video-container' id
    var subscriber = session.subscribe(event.stream, 'video-container');

    // When the HTML video has been appended to DOM...
    subscriber.on('videoElementCreated', function (event) {

        // Add a new &lt;p&gt; element for the user's name and nickname just below its video
        appendUserData(event.element, subscriber.stream.connection);
    });
});

// On every Stream destroyed...
session.on('streamDestroyed', function (event) {
    // Delete the HTML element with the user's name and nickname
    removeUserData(event.stream.connection);
});


// --- 3) Connect to the session passing the retrieved token and some more data from
//         the client (in this case a JSON with the nickname chosen by the user) ---

session.connect(token, '{&quot;clientData&quot;: &quot;' + nickName + '&quot;}', function (error) {

    // If the connection is successful, initialize a publisher and publish to the session
    if (!error) {

        // Here we check somehow if the user has at least 'PUBLISHER' role before
        // trying to publish its stream. Even if someone modified the client's code and
        // published the stream, it wouldn't work if the token sent in Session.connect
        // method doesn't belong to a 'PUBLIHSER' role
        if (isPublisher()) {

            // --- 4) Get your own camera stream ---

            var publisher = OV.initPublisher('video-container', {
                audio: true,
                video: true,
                quality: 'MEDIUM'
            });

            // When our HTML video has been added to DOM...
            publisher.on('videoElementCreated', function (event) {
                // Init the main video with ours and append our data
                var userData = {
                    nickName: nickName,
                    userName: userName
                };
                initMainVideo(event.element, userData);
                appendUserData(event.element, userData);
                $(event.element).prop('muted', true); // Mute lcoal video
            });


            // --- 5) Publish your stream ---

            session.publish(publisher);

        } else {
            console.warn('You don\'t have permissions to publish');
            initMainVideoThumbnail(); // Show SUBSCRIBER message in main video
        }
    } else {
        console.warn('There was an error connecting to the session:', error.code, error.message);
    }
});

// HTML shows session page ...
</code></pre>

<p>The user will now see its own video on the page. The connection to the session has completed!</p>
<hr />
<h3 id="3-another-user-connects-to-the-video-call">3) Another user connects to the video-call</h3>
<p>The process would be exactly the same as before until <code>server.js</code> executes controller at <code>/api-sessions/get-sessionid-token</code>. Now session 'TUTORIAL' already exists, so in the <em>if-else</em> statement the <em>if</em> branch would be the one executed:</p>
<pre><code class="javascript">if (mapSessionNameSession[sessionName]) {
    // Session already exists: return existing sessionId and a new token

    // Get the existing Session from the collection
    var mySession = mapSessionNameSession[sessionName];

    // Generate a new token asynchronously with the recently created tokenOptions
    mySession.generateToken(tokenOptions, function (token) {

        // Get the existing sessionId
        mySession.getSessionId(function (sessionId) {

            // Store the new token in the collection of tokens
            mapSessionIdTokens[sessionId].push(token);

            // Return the sessionId and token to the client
            res.status(200).send({
                0: sessionId,
                1: token
            });
        });
    });
}
</code></pre>

<p>The code executed in <code>app.js</code> would also be the same. After the <code>Session.publish()</code> method has been succesful, both users will be seeing each other's video, as well as the username and the nickname below it.</p>
<hr />
<h3 id="4-users-leave-the-video-call">4) Users leave the video-call</h3>
<p>After a while both users decide to leave the session. Apart from calling <code>leaveSession()</code> (and therefore <code>session.disconnect()</code>) to destroy the connection on openvidu-server, we need to run the last HTTP operation: we must let the backend know that certain user has left the session so it can update the collections with the active sessions and tokens. To sum up, <code>session.disconnect()</code> updates our openvidu-server and the POST operation updates our backend.
For the POST operation, in <code>app.js</code> we run:</p>
<pre><code class="javascript">function removeUser() {
    // Body of POST request with the name of the session and the token of the leaving user
    var jsonBody = JSON.stringify({
        'sessionName': sessionName,
        'token': token
    });

    // Send POST request
    httpRequest('POST', '/api-sessions/remove-user', jsonBody,
        'User couldn\'t be removed from session', function successCallback(response) {
        console.warn(userName + ' correctly removed from session ' + sessionName);
    });
}
</code></pre>

<p>And in <code>server.js</code> we update the collections in <code>/api-sessions/remove-user</code>:</p>
<pre><code class="javascript">app.post('/api-sessions/remove-user', function (req, res) {
    // Check the user is logged ...

    // Retrieve params from POST body
    var sessionName = req.body.sessionName;
    var token = req.body.token;

    // If the session exists
    var mySession = mapSessionNameSession[sessionName];
    if (mySession) {
        mySession.getSessionId(function (sessionId) {
            var tokens = mapSessionIdTokens[sessionId];
            if (tokens) {
                var index = tokens.indexOf(token);

                // If the token exists
                if (index !== -1) {
                    // Token removed!
                    tokens.splice(index, 1);
                } else {
                    var msg = 'Problems in the app server: the TOKEN wasn\'t valid';
                    res.status(500).send(msg);
                }
                if (mapSessionIdTokens[sessionId].length == 0) {
                    // Last user left: session must be removed
                    delete mapSessionNameSession[sessionName];
                }
                res.status(200).send();
            } else {
                var msg = 'Problems in the app server: the SESSIONID wasn\'t valid';
                res.status(500).send(msg);
            }
        });
    } else {
        var msg = 'Problems in the app server: the SESSION does not exist';
        res.status(500).send(msg);
    }
</code></pre>

<p>When the last user leaves the session <code>delete mapSessionNameSession[sessionName]</code> will be executed: this means the session is empty and that it is going to be closed. The <em>sessionId</em> and all <em>token</em> params associated to it will be invalidated.</p>
<hr />
<blockquote>
<p>At this point we have covered all the important code from the tutorial. With this scenario we have seen the most common use-case, but you can modify whatever you want to suit your needs. And remember that this is just one of the many possible approaches: <strong>you can implement your frontend and your backend as you want</strong>. </p>
<p>The only actual requirements are getting <strong><em>sessionId</em></strong> and <strong><em>token</em></strong> params from  <strong><em>openvidu-server</em></strong> (by using one of the available clients or with the REST API) and using them along with <strong><em>openvidu-browser</em></strong> to connect your clients to the sessions.</p>
</blockquote>
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>
<script>
  $().fancybox({
    selector : '[data-fancybox="gallery"]',
    infobar : true,
    arrows : false,
    loop: true,
    protect: true,
    transitionEffect: 'slide',
    buttons : [
        'close'
    ],
    clickOutside : 'close',
    clickSlide   : 'close',
  });
</script></p> 
						</div>
					</div> <footer>
<hr>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../openvidu-mvc-node/" class="btn btn-xs btn-primary float-right" title="openvidu-mvc-node">Next &raquo;<span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../openvidu-mvc-java/" class="btn btn-xs btn-primary" title="openvidu-mvc-java"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  <div id="edit-github">
  
	  <a href="https://github.com/OpenVidu/openvidu.io-docs/blob/master/docs/tutorials/openvidu-js-node.md"><i class="icon ion-social-github"></i> Edit Documentation on GitHub</a>
  
  </div>
</footer> 
				</div>
			</div>
		</section>
</div>